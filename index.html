<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OpenVoice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui, Arial, sans-serif;
  background: #f6f7f9;
  padding: 20px;
}
.container {
  max-width: 420px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
}
h2 { text-align: center; margin-bottom: 6px; }
.sub { text-align: center; font-size: 13px; color: #666; margin-bottom: 20px; }
label { font-weight: 600; margin-top: 14px; display: block; }
.req { color: #d32f2f; margin-left: 2px; }
input, select, textarea { width: 100%; padding: 10px; margin-top: 6px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box; }
textarea { min-height: 90px; }
.helper { font-size: 12px; color: #666; margin-top: 4px; }
.hidden { display: none; }
button { width: 100%; margin-top: 20px; padding: 12px; border: none; background: #1e88e5; color: #fff; border-radius: 8px; font-size: 15px; cursor: pointer; }
.success { text-align: center; padding: 30px 10px; }
</style>
</head>

<body>
<div class="container" id="app">
  <div style="text-align:center; padding:60px 10px; color:#888;">Loading OpenVoice‚Ä¶</div>
</div>

<script>
/* CLIENT CONFIG */
const CLIENT_CONFIG = {
  "GVL001": { name: "GVLC Fibre Net", clientId: "GVL-ISP-001", scriptUrl: "https://script.google.com/macros/s/AKfycbxnVFfCudI6OyZwoGGHG5YNuNJ4EpiePXOBlijtbU8qbQXH6XcSHhfm_NPDbZeUndxTxg/exec" },
  "FIT001": { name: "FitZone Gym", clientId: "FIT-GYM-001", scriptUrl: "" }
};

const params = new URLSearchParams(window.location.search);
const clientKey = params.get("client");
const app = document.getElementById("app");

if (!clientKey || !CLIENT_CONFIG[clientKey]) {
  app.innerHTML = `<div style="text-align:center; padding:60px 20px;"><h2>Invalid QR Code</h2><p>This link is not assigned to any client.</p></div>`;
  throw new Error("Invalid client");
}

const CLIENT = CLIENT_CONFIG[clientKey];
const SCRIPT_URL = CLIENT.scriptUrl;

app.innerHTML = `
  <div id="formBox">
    <h2>${CLIENT.name}</h2>
    <div class="sub">Raise a complaint, feedback, or suggestion</div>

    <label>User Name <span class="req">*</span></label>
    <input id="userName" type="text" required>

    <label>Registered Mobile Number</label>
    <input id="mobile" type="tel" placeholder="Enter your 10-digit number">
    <div class="helper"><span class="req">*</span> At least one contact method (Mobile or Email) is required for Complaint & Feedback</div>

    <label>Email Address</label>
    <input id="email" type="email">

    <label>Location / Area</label>
    <input id="userLocation" type="text" placeholder="e.g. Street Name, Flat No">

    <label>Request Type <span class="req">*</span></label>
    <select id="requestType" onchange="handleType()" required>
      <option value="">Select</option>
      <option value="Complaint">Complaint</option>
      <option value="Suggestion">Suggestion</option>
      <option value="Feedback">Feedback</option>
    </select>

    <label id="msgLabel">Message <span class="req">*</span></label>
    
    <select id="complaintDropdown" class="hidden" onchange="handleComplaintChange()">
      <option value="">Select Issue...</option>
      <option value="Internet not working">Internet not working</option>
      <option value="Landline not working">Landline not working</option>
      <option value="OTT apps not working">OTT apps not working</option>
      <option value="Redlight blinking on router">Redlight blinking on router</option>
      <option value="Power not showing on router">Power not showing on router</option>
      <option value="Others">Others</option>
    </select>

    <textarea id="messageText" class="hidden" placeholder="Type your details here..."></textarea>

    <div id="imgBlock" class="hidden">
      <label>Upload Image (optional)</label>
      <input type="file" id="image" accept="image/*">
    </div>

    <button type="button" onclick="submitForm()">Submit</button>
  </div>

  <div id="successBox" class="success hidden">
    <h3 id="sTitle"></h3>
    <p id="sMsg"></p>
  </div>
`;

function handleType() {
  const type = document.getElementById("requestType").value;
  const imgBlock = document.getElementById("imgBlock");
  const msgLabel = document.getElementById("msgLabel");
  const complaintDropdown = document.getElementById("complaintDropdown");
  const messageText = document.getElementById("messageText");

  complaintDropdown.value = ""; messageText.value = "";
  imgBlock.classList.toggle("hidden", type !== "Complaint");

  if (type === "Complaint") {
    msgLabel.innerHTML = 'Select Issue <span class="req">*</span>';
    complaintDropdown.classList.remove("hidden");
    messageText.classList.add("hidden"); 
  } else if (type === "Feedback") {
    msgLabel.innerHTML = 'Your Message <span class="req">*</span>';
    complaintDropdown.classList.add("hidden");
    messageText.classList.remove("hidden");
    messageText.placeholder = "Tell us about your experience with our service or technician...";
  } else if (type === "Suggestion") {
    msgLabel.innerHTML = 'Your Message <span class="req">*</span>';
    complaintDropdown.classList.add("hidden");
    messageText.classList.remove("hidden");
    messageText.placeholder = "How can we improve? (e.g. New plans, new areas, app features)...";
  } else {
    msgLabel.innerHTML = 'Message <span class="req">*</span>';
    complaintDropdown.classList.add("hidden");
    messageText.classList.add("hidden");
  }
}

function handleComplaintChange() {
  const dropdown = document.getElementById("complaintDropdown");
  const textBox = document.getElementById("messageText");
  if (dropdown.value === "Others") {
    textBox.classList.remove("hidden");
    textBox.placeholder = "Please describe your problem...";
  } else {
    textBox.classList.add("hidden");
  }
}

function submitForm() {
  const type = document.getElementById("requestType").value;
  const name = document.getElementById("userName").value.trim();
  const location = document.getElementById("userLocation").value.trim();
  const mobile = document.getElementById("mobile").value.trim();
  const email = document.getElementById("email").value.trim();
  
  let finalMessage = "";
  const dropdownVal = document.getElementById("complaintDropdown").value;
  const textVal = document.getElementById("messageText").value.trim();

  if (type === "Complaint") {
    if (!dropdownVal) { alert("Please select an issue."); return; }
    if (dropdownVal === "Others") {
       if (!textVal) { alert("Please type your problem description."); return; }
       finalMessage = "Other: " + textVal;
    } else { finalMessage = dropdownVal; }
  } else {
    if (!textVal) { alert("Please enter your message."); return; }
    finalMessage = textVal;
  }

  if (!type || !name) { alert("Please fill all required fields (marked with *)."); return; }
  if ((type === "Complaint" || type === "Feedback") && !mobile && !email) {
    alert("Please provide Registered Mobile Number or Email.");
    return;
  }

  const payload = {
    requestType: type, name: name, location: location, mobile: mobile, email: email,
    message: finalMessage, attachments: "", clientName: CLIENT.name, clientId: CLIENT.clientId
  };

  const btn = document.querySelector("button");
  const originalText = btn.innerText;
  btn.innerText = "Submitting...";
  btn.disabled = true;

  fetch(SCRIPT_URL, {
    method: "POST", body: JSON.stringify(payload)
  }).then(res => res.json()).then(data => {
    if (data.success) showSuccess(type);
    else { alert("Submission failed. Please try again."); btn.innerText = originalText; btn.disabled = false; }
  }).catch(() => {
    alert("Network error. Please try again."); btn.innerText = originalText; btn.disabled = false;
  });
}

function showSuccess(type) {
  document.getElementById("formBox").classList.add("hidden");
  document.getElementById("successBox").classList.remove("hidden");
  const title = document.getElementById("sTitle");
  const msg = document.getElementById("sMsg");

  if (type === "Complaint") {
    title.innerText = "‚úÖ Complaint Received";
    msg.innerText = "Your complaint has been submitted successfully.";
  } else if (type === "Feedback") {
    title.innerText = "üôè Thank You for Your Feedback";
    msg.innerText = "We appreciate your feedback.";
  } else {
    title.innerText = "üí° Suggestion Received";
    msg.innerText = "Thank you for your suggestion.";
  }
}
</script>
</body>
</html>

